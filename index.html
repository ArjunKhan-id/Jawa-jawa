<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8">
    <title>Anjay Arjun Bikin Link Dongg</title>

    <!-- Judul & Jam Realtime -->
    <label style="font-size: 32px;">Waktu DitempatMu</label>
    <div id="clock" style="font-size: 48px; margin-top: 20px;">00:00:00</div>

    <script>
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</head>
<body>

    <h2>plis smarid, why u tolak my loved :(</h2>
    <p>gw bakar jg luüòî</p>

    <form id="formGaffar">
        Cari Apa sayang: <input type="text" name="cariApa"><br><br>
        Nama: <input type="text" name="nama" placeholder="Masukkan nama"><br><br>
        Email: <input type="email" name="email" placeholder="Masukkan email"><br><br>
        Nomor Telepon: <input type="tel" name="noHp" placeholder="Masukkan nomor HP"><br><br>
        Umur: <input type="number" name="umur"><br><br>
        Tanggal Lahir: <input type="date" name="tglLahir"><br><br>
        <p>kalo g mw isi karna menurut mu itu privasi, gpp, isi nama aj boleh kok</p>

        Upload Pap: <input type="file" id="file_input" /><br><br>

        <!-- Tombol Kirim -->
        <button type="button" onclick="simpanKeFirestore()">Kirim</button>
    </form><br>

    <!-- Tombol pindah halaman -->
    <button onclick="window.location.href='Burit.html'">Pencet njing</button>

    <!-- Firebase SDK (modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAtfRN00AdlZkxNens-D1u83RKKDdXIiYk",
            authDomain: "ketolak-smarid.firebaseapp.com",
            projectId: "ketolak-smarid",
            storageBucket: "ketolak-smarid.firebasestorage.app",
            messagingSenderId: "313273590739",
            appId: "1:313273590739:web:82a4b0c5a21272a6fc4526",
            measurementId: "G-HME396LV9Z"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const CLIENT_ID = 'MASUKKAN_CLIENT_ID_KAMU_DI_SINI';
        const API_KEY = 'MASUKKAN_API_KEY_KAMU_DI_SINI';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let accessToken;

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(() => {
                const authInstance = gapi.auth2.getAuthInstance();
                authInstance.isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(authInstance.isSignedIn.get());
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                accessToken = gapi.auth.getToken().access_token;
            } else {
                gapi.auth2.getAuthInstance().signIn();
            }
        }

        window.simpanKeFirestore = async function () {
            const form = document.getElementById('formGaffar');
            const data = {
                cariApa: form.cariApa.value,
                nama: form.nama.value,
                email: form.email.value,
                noHp: form.noHp.value,
                umur: form.umur.value,
                tglLahir: form.tglLahir.value,
                mainApa: Array.from(form.querySelectorAll('[name="mainApa"]:checked')).map(e => e.value),
                gender: form.querySelector('[name="gender"]:checked')?.value || '',
                ambatukam: form.ambatukam.value,
                komentar: form.komentar.value,
                imut: form.imut.value
            };

            try {
                // Simpan data ke Firestore
                await addDoc(collection(db, "BotakGaffar"), data);
                alert("Data berhasil disimpan ke Firestore!");

                // Upload file ke Google Drive
                const file = document.getElementById('file_input').files[0];
                if (file) {
                    const metadata = {
                        'name': file.name,
                        'mimeType': file.type
                    };

                    const formData = new FormData();
                    formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    formData.append('file', file);

                    const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
                        method: 'POST',
                        headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                        body: formData,
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert('‚úÖ File berhasil di-upload ke Google Drive!\nFile ID: ' + result.id);
                    } else {
                        alert('‚ùå Upload gagal: ' + result.error.message);
                    }
                }
            } catch (e) {
                console.error("Gagal menyimpan data:", e);
                alert("Gagal menyimpan data!");
            }
        };

        handleClientLoad();
    </script>

</body>
</html>
